<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Men's T20I Milestones</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="dashboard_data.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #0d1117;
            --card-bg: #161b22;
            --text-primary: #f0f6fc;
            --text-secondary: #8b949e;
            --border-color: #30363d;
            --accent: #58a6ff;
            --table-hover: #1f242c;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            max-width: 1200px;
            width: 100%;
        }

        header {
            margin-bottom: 40px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 20px;
        }

        h1 {
            font-size: 24px;
            font-weight: 600;
            margin: 0;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 14px;
            margin-top: 8px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .card {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 20px;
        }

        .card h3 {
            margin-top: 0;
            font-size: 14px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .stat-label {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
            margin-bottom: 40px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        th,
        td {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            color: var(--text-secondary);
            font-weight: 500;
        }

        tr:hover {
            background-color: var(--table-hover);
        }

        .filters {
            margin-bottom: 10px;
        }

        button {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-family: inherit;
            margin-right: 10px;
            transition: all 0.2s;
        }

        button.active,
        button:hover {
            border-color: var(--accent);
            color: var(--text-primary);
        }
    </style>
</head>

<body>

    <div class="container">
        <header>
            <h1>Global Men's T20I Milestones</h1>
            <div class="subtitle">Fastest team 50s, 100s, 150s, 200s, 250s for ALL Teams</div>
        </header>

        <!-- Controls Section -->
        <div class="card" style="margin-bottom: 20px;">
            <div class="filters-container" style="display: flex; gap: 15px; flex-wrap: wrap; align-items: center;">
                <div>
                    <label for="milestoneFilter"
                        style="color: var(--text-secondary); font-size: 12px; display: block; margin-bottom: 4px;">Milestone</label>
                    <div class="filters">
                        <button class="active" onclick="setMilestone(50)">50</button>
                        <button onclick="setMilestone(100)">100</button>
                        <button onclick="setMilestone(150)">150</button>
                        <button onclick="setMilestone(200)">200</button>
                        <button onclick="setMilestone(250)">250</button>
                    </div>
                </div>

                <div style="flex-grow: 1;"></div>

                <div>
                    <label for="teamFilter"
                        style="color: var(--text-secondary); font-size: 12px; display: block; margin-bottom: 4px;">Team</label>
                    <select id="teamFilter" onchange="renderDashboard()"
                        style="padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-color); color: var(--text-primary); border-left: 3px solid var(--accent); max-width: 200px;">
                        <option value="All">All Teams</option>
                    </select>
                </div>

                <div>
                    <label for="opponentFilter"
                        style="color: var(--text-secondary); font-size: 12px; display: block; margin-bottom: 4px;">Opponent</label>
                    <select id="opponentFilter" onchange="renderDashboard()"
                        style="padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-color); color: var(--text-primary); max-width: 200px;">
                        <option value="All">All Opponents</option>
                    </select>
                </div>

                <div>
                    <label for="yearFilter"
                        style="color: var(--text-secondary); font-size: 12px; display: block; margin-bottom: 4px;">Year</label>
                    <select id="yearFilter" onchange="renderDashboard()"
                        style="padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-color); color: var(--text-primary);">
                        <option value="All">All Years</option>
                    </select>
                </div>

                <div>
                    <label for="searchFilter"
                        style="color: var(--text-secondary); font-size: 12px; display: block; margin-bottom: 4px;">Search</label>
                    <input type="text" id="searchFilter" placeholder="Venue, Team..." onkeyup="renderDashboard()"
                        style="padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-color); color: var(--text-primary);">
                </div>

                <div>
                    <label
                        style="color: var(--text-secondary); font-size: 12px; display: block; margin-bottom: 4px;">&nbsp;</label>
                    <button onclick="resetFilters()" style="background-color: #21262d;">Reset</button>
                </div>
            </div>
        </div>

        <!-- KPI Cards -->
        <div class="grid">
            <div class="card">
                <h3>Fastest Team 50</h3>
                <div class="stat-value" id="fastest-50">-</div>
                <div class="stat-label" id="fastest-50-details">Loading...</div>
            </div>
            <div class="card">
                <h3>Fastest Team 100</h3>
                <div class="stat-value" id="fastest-100">-</div>
                <div class="stat-label" id="fastest-100-details">Loading...</div>
            </div>
            <div class="card">
                <h3>Fastest Team 150</h3>
                <div class="stat-value" id="fastest-150">-</div>
                <div class="stat-label" id="fastest-150-details">Loading...</div>
            </div>
            <div class="card">
                <h3>Fastest Team 200</h3>
                <div class="stat-value" id="fastest-200">-</div>
                <div class="stat-label" id="fastest-200-details">Loading...</div>
            </div>
            <div class="card">
                <h3>Fastest Team 250</h3>
                <div class="stat-value" id="fastest-250">-</div>
                <div class="stat-label" id="fastest-250-details">Loading...</div>
            </div>
        </div>

        <div class="card">
            <h3>Top 20 Fastest Records (Current Selection)</h3>
            <div class="chart-container">
                <canvas id="milestoneChart"></canvas>
            </div>
        </div>

        <div class="card" style="margin-top: 40px;">
            <h3>Full Record List</h3>
            <div style="overflow-x: auto;">
                <table id="recordsTable">
                    <thead>
                        <tr>
                            <th onclick="sortTable('date')" style="cursor: pointer;">Date ↕</th>
                            <th onclick="sortTable('team')" style="cursor: pointer;">Team ↕</th>
                            <th onclick="sortTable('opponent')" style="cursor: pointer;">Opponent ↕</th>
                            <th onclick="sortTable('venue')" style="cursor: pointer;">Venue ↕</th>
                            <th onclick="sortTable('milestone')" style="cursor: pointer;">Milestone ↕</th>
                            <th onclick="sortTable('legal_balls_faced')" style="cursor: pointer;">Balls Taken ↕</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Rows -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        if (!window.milestoneData) {
            document.body.innerHTML = "<h1>Error: dashboard_data.js not loaded.</h1>";
        }

        // Enhance data with Year for easier filtering
        const rawData = window.milestoneData.map(d => ({
            ...d,
            year: d.date.split('/')[0] // Assuming YYYY/MM/DD format
        }));

        let currentMilestone = 50;
        let chartInstance = null;
        let sortCol = 'legal_balls_faced';
        let sortAsc = true;

        // Initialize Options
        function initFilters() {
            const teams = [...new Set(rawData.map(d => d.team))].sort();
            const opponents = [...new Set(rawData.map(d => d.opponent))].sort();
            const years = [...new Set(rawData.map(d => d.year))].sort().reverse();

            const teamSelect = document.getElementById('teamFilter');
            teams.forEach(t => {
                const opt = document.createElement('option');
                opt.value = t;
                opt.innerText = t;
                teamSelect.appendChild(opt);
            });

            const oppSelect = document.getElementById('opponentFilter');
            opponents.forEach(op => {
                const opt = document.createElement('option');
                opt.value = op;
                opt.innerText = op;
                oppSelect.appendChild(opt);
            });

            const yearSelect = document.getElementById('yearFilter');
            years.forEach(y => {
                const opt = document.createElement('option');
                opt.value = y;
                opt.innerText = y;
                yearSelect.appendChild(opt);
            });
        }

        function setMilestone(m) {
            currentMilestone = m;
            document.querySelectorAll('.filters button').forEach(b => {
                b.classList.remove('active');
                if (b.innerText === String(m)) b.classList.add('active');
            });
            renderDashboard();
        }

        function resetFilters() {
            document.getElementById('teamFilter').value = "All";
            document.getElementById('opponentFilter').value = "All";
            document.getElementById('yearFilter').value = "All";
            document.getElementById('searchFilter').value = "";
            setMilestone(50);
        }

        function sortTable(col) {
            if (sortCol === col) {
                sortAsc = !sortAsc;
            } else {
                sortCol = col;
                sortAsc = true;
            }
            renderDashboard();
        }

        function getFastestInSubset(subset, milestone) {
            const records = subset.filter(d => d.milestone === milestone);
            if (records.length === 0) return null;
            return records.reduce((prev, curr) => prev.legal_balls_faced < curr.legal_balls_faced ? prev : curr);
        }

        function renderDashboard() {
            // 1. Filter Data
            const teamFilter = document.getElementById('teamFilter').value;
            const oppFilter = document.getElementById('opponentFilter').value;
            const yearFilter = document.getElementById('yearFilter').value;
            const searchText = document.getElementById('searchFilter').value.toLowerCase();

            let filtered = rawData.filter(d => {
                if (teamFilter !== "All" && d.team !== teamFilter) return false;
                if (oppFilter !== "All" && d.opponent !== oppFilter) return false;
                if (yearFilter !== "All" && d.year !== yearFilter) return false;

                if (searchText) {
                    const searchStr = `${d.team} ${d.venue} ${d.date} ${d.opponent}`.toLowerCase();
                    if (!searchStr.includes(searchText)) return false;
                }
                return true;
            });

            // 2. Update KPI Cards (Fastest for each milestone within CURRENT FILTER)
            updateKPICard(filtered, 50, 'fastest-50');
            updateKPICard(filtered, 100, 'fastest-100');
            updateKPICard(filtered, 150, 'fastest-150');
            updateKPICard(filtered, 200, 'fastest-200');
            updateKPICard(filtered, 250, 'fastest-250');

            // 3. Prepare Data for Chart & Table (Filtered by selected Milestone)
            let displayData = filtered.filter(d => d.milestone === currentMilestone);

            // Sort
            displayData.sort((a, b) => {
                let valA = a[sortCol];
                let valB = b[sortCol];

                if (typeof valA === 'string') {
                    return sortAsc ? valA.localeCompare(valB) : valB.localeCompare(valA);
                }
                return sortAsc ? valA - valB : valB - valA;
            });

            // 4. Render Chart (Top 20 of sorted data)
            const chartData = [...displayData].sort((a, b) => a.legal_balls_faced - b.legal_balls_faced).slice(0, 20);
            updateChart(chartData);

            // 5. Render Table
            updateTable(displayData);
        }

        function updateKPICard(dataSubset, milestone, elementId) {
            const best = getFastestInSubset(dataSubset, milestone);
            const valEl = document.getElementById(elementId);
            const labelEl = document.getElementById(elementId + '-details');

            if (best) {
                valEl.innerText = `${best.legal_balls_faced} balls`;
                // Show Team name too since it's global now
                labelEl.innerText = `${best.team} vs ${best.opponent} (${best.date})`;
            } else {
                valEl.innerText = "-";
                labelEl.innerText = "None in selection";
            }
        }

        function updateChart(records) {
            // Label now needs to include Team Name
            const labels = records.map(d => `${d.team} vs ${d.opponent} (${d.date})`);
            const values = records.map(d => d.legal_balls_faced);

            const ctx = document.getElementById('milestoneChart').getContext('2d');

            if (chartInstance) chartInstance.destroy();

            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `Balls faced to reach ${currentMilestone}`,
                        data: values,
                        backgroundColor: '#58a6ff',
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    return `${context.parsed.y} balls`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: '#30363d' },
                            ticks: { color: '#8b949e' }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#8b949e', maxRotation: 45, minRotation: 45 }
                        }
                    }
                }
            });
        }

        function updateTable(records) {
            const tbody = document.querySelector('#recordsTable tbody');
            tbody.innerHTML = '';

            const rowsToShow = records.slice(0, 100);

            rowsToShow.forEach(r => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${r.date}</td>
                    <td><b>${r.team}</b></td>
                    <td>${r.opponent}</td>
                    <td>${r.venue || '-'}</td>
                    <td>${r.milestone}</td>
                    <td>${r.legal_balls_faced}</td>
                 `;
                tbody.appendChild(row);
            });

            if (records.length > 100) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="6" style="text-align: center; color: var(--text-secondary);">...and ${records.length - 100} more records</td>`;
                tbody.appendChild(row);
            }
        }

        initFilters();
        renderDashboard();

    </script>
</body>

</html>